# Iron Condor Screener & Analyzer

<div align="center">
  <img src="../../../images/logo.png" alt="Project Logo" width="100%"/>
</div>

A powerful Python tool for finding and analyzing iron condor options strategies. This screener helps you identify the best iron condor opportunities with comprehensive risk analysis and probability calculations.

## 🎯 What is an Iron Condor?

An iron condor is a neutral options strategy that profits when the underlying stock stays within a specific price range. It consists of four legs:

- **Sell Call Spread**: Sell a lower strike call, buy a higher strike call
- **Sell Put Spread**: Sell a higher strike put, buy a lower strike put
- **Same Expiration**: All four legs must have the same expiration date
- **Net Credit**: Collect premium from both spreads

The strategy profits when the stock price stays between the two sold strikes at expiration.

## ✨ Features

- **Real-time Options Data**: Uses Polygon.io API for live options chains
- **Risk Analysis**: Calculates max profit, max loss, and probability of profit
- **Multiple Ranking Criteria**: Sort by credit, probability, or risk/reward ratio
- **Flexible Filtering**: Set minimum credit, maximum risk, and probability thresholds
- **CSV Export**: Save results for further analysis with earnings warnings
- **P&L Tracking**: Calculate actual performance after expiration
- **CLI Interface**: Easy-to-use command-line interface
- **Earnings Alerts**: Automatically checks for upcoming earnings and flags them in results
- **Smart Ranking**: Results ranked by net credit (highest first) with customizable limits
- **Auto Folder Creation**: Automatically creates data directory for CSV exports

## Disclaimer

**Warning:** The examples, demos, and outputs produced with this project are generated by artificial intelligence and large language models. You acknowledge that this project and any outputs are provided "AS IS", may not always be accurate and may contain material inaccuracies even if they appear accurate because of their level of detail or specificity, outputs may not be error free, accurate, current, complete, or operate as you intended, you should not rely on any outputs or actions without independently confirming their accuracy, and any outputs should not be treated as financial or legal advice. You remain responsible for verifying the accuracy, suitability, and legality of any output before relying on it.

## 🚀 Quick Start

### Prerequisites

- Python 3.10 or higher
- Polygon.io API key (**Must be on Options Advanced license type**)

### Installation

1. **Clone the repository:**
   ```bash
   git clone <repository-url>
   cd iron-condor-screener
   ```

2. **Install dependencies:**
   ```bash
   pip install -e .
   ```

3. **Set up environment:**
   ```bash
   cp .env.example .env
   # Edit .env and add your Polygon.io API key
   ```

4. **Get your Polygon.io API key:**
   - Visit [polygon.io](https://polygon.io/dashboard)
   - Sign up for an account
   - Upgrade to Options Advanced
   - Copy your API key to the `.env` file

### Basic Usage

**Find iron condor opportunities:**
```bash
uv run screener.py find --symbol SPY
```

**Find with custom filters:**
```bash
uv run screener.py find --symbol AAPL --max-days 14 --min-credit 1.00 --max-risk 3.00 --limit 5
```

**Calculate P&L after expiration:**
```bash
uv run screener.py pnl --csv data/spy_iron_condors.csv
```

## 📖 Detailed Usage

### Find Command

The `find` command searches for iron condor opportunities:

```bash
uv run screener.py find [OPTIONS]
```

**Options:**
- `--symbol`: Stock symbol (required, e.g., SPY, AAPL, TSLA)
- `--max-days`: Maximum days to expiration (default: 7)
- `--min-credit`: Minimum net credit required (default: 0.10)
- `--max-risk`: Maximum risk allowed (default: 10.00)
- `--min-probability`: Minimum probability of profit % (default: 30.0)
- `--criteria`: Ranking criteria - `credit`, `probability`, or `risk_reward` (default: credit)
- `--limit`: Maximum number of iron condors to save to CSV (default: 10)

**Examples:**
```bash
# Find SPY iron condors expiring within 7 days
uv run screener.py find --symbol SPY

# Find AAPL iron condors with higher credit requirements
uv run screener.py find --symbol AAPL --min-credit 1.50 --max-risk 4.00

# Rank by probability of profit
uv run screener.py find --symbol TSLA --criteria probability

# Look for longer-term opportunities
uv run screener.py find --symbol QQQ --max-days 21 --min-probability 70

# Limit results to top 5 iron condors
uv run screener.py find --symbol SPY --limit 5
```

### P&L Command

The `pnl` command calculates actual performance after expiration:

```bash
uv run screener.py pnl --csv <path-to-csv>
```

**Example:**
```bash
uv run screener.py pnl --csv data/spy_iron_condors.csv
```

## 🆕 New Features

### Earnings Alerts
The screener automatically checks for upcoming earnings using Polygon's Benzinga earnings data and includes a `has_upcoming_earnings` flag in the CSV output. When earnings are detected, you'll see a warning message:

```
⚠️  Warning: AAPL has upcoming earnings within 7 days
```

### Smart Ranking & Limits
- **Default Ranking**: Results are ranked by net credit (highest first)
- **Customizable Limits**: Use `--limit N` to control how many iron condors are saved to CSV
- **Focused Results**: Default limit of 10 prevents overwhelming output

### Auto Folder Creation
The screener automatically creates a `data/` folder if it doesn't exist, so you don't need to create it manually.

### Git Integration
The `data/` folder and CSV files are automatically ignored by Git to prevent committing large data files.

## 📊 Understanding the Output

### Sample Output

```
🔍 Scanning SPY for iron condor opportunities...
💰 Current spot price: $660.30
📅 Found 6 available expirations
🎯 Using filters: {'min_net_credit': 0.50, 'max_risk': 2.00, 'min_probability': 60.0%}
🏆 Found 12 total iron condors. Top options by different criteria:

📊 Top 5 by Credit:
   =====================================================================================================
   Exp        Call Spread    Put Spread    Net Credit  Max Profit  Max Loss   PoP%   Risk/Reward
   -----------------------------------------------------------------------------------------------------
   09-23      $665/$670      $650/$645     $1.25       $1.25       $3.75      68.2%  0.33
   09-19      $666/$671      $651/$646     $1.15       $1.15       $3.85      67.8%  0.30

🎯 Top Recommendation: 2025-09-23 $665/$670 call spread + $650/$645 put spread
   Net Credit: $1.25 | Max Profit: $1.25 | PoP: 68.2% | Risk/Reward: 0.33

💾 Saved CSV file: data/spy_iron_condors.csv
💡 Next step: Run 'uv run screener.py pnl --csv data/spy_iron_condors.csv' after expiration
```

### Key Metrics Explained

- **Net Credit**: Total premium collected from the strategy
- **Max Profit**: Maximum profit if stock stays in profit zone (equals net credit)
- **Max Loss**: Maximum loss if stock moves outside profit zone
- **PoP%**: Probability of Profit - chance stock stays between sold strikes
- **Risk/Reward**: Ratio of max profit to max loss
- **Profit Zone**: Range between the two sold strikes

## 🔧 Configuration

### Environment Variables

Create a `.env` file with the following variables:

```bash
# Required
POLYGON_API_KEY=your_api_key_here

# Optional
DEBUG=false  # Set to 'true' for detailed logging
```

### Filtering Options

**Minimum Net Credit**: Only show strategies that collect at least this much premium
- Higher values = more conservative, higher probability strategies
- Lower values = more aggressive, higher reward strategies

**Maximum Risk**: Only show strategies with risk below this threshold
- Lower values = more conservative strategies
- Higher values = allow for more aggressive strategies

**Minimum Probability**: Only show strategies with at least this probability of profit
- Higher values = more conservative strategies
- Lower values = allow for more aggressive strategies

## 📁 Project Structure

```
iron-condor-screener/
├── README.md                    # This file
├── pyproject.toml               # Dependencies and project metadata
├── env.example                  # Environment template
├── LICENSE                      # MIT license
├── screener.py                  # Main application (single file)
└── data/                        # CSV output files
    └── .gitkeep
```

## 🧮 How It Works

### Iron Condor Construction

1. **Fetch Options Chains**: Retrieves calls and puts for available expirations
2. **Filter for Liquidity**: Only considers options with sufficient volume and open interest
3. **Generate Combinations**: Creates all possible iron condor combinations
4. **Calculate Metrics**: Computes risk/reward metrics for each combination
5. **Apply Filters**: Removes strategies that don't meet criteria
6. **Rank Results**: Sorts by selected criteria (credit, probability, or risk/reward)

### Risk Calculations

- **Max Profit**: Net credit received (if stock stays between sold strikes)
- **Max Loss**: (Call spread width + Put spread width) - Net credit
- **Profit Zone**: Range between the two sold strikes
- **Probability**: Simplified calculation based on profit zone width

### Data Sources

- **Real-time Options Data**: Polygon.io API
- **Current Stock Prices**: Polygon.io last trade data
- **Options Chains**: Live bid/ask prices, volume, and open interest

## ⚠️ Important Disclaimers

- **Educational Purpose**: This tool is for educational and research purposes only
- **Not Financial Advice**: Results should not be considered as investment advice
- **Risk Warning**: Options trading involves significant risk of loss
- **Data Accuracy**: While we strive for accuracy, always verify data independently
- **API Limits**: Free Polygon.io accounts have rate limits

## 🐛 Troubleshooting

### Common Issues

**"POLYGON_API_KEY not found"**
- Make sure you've created a `.env` file with your API key
- Verify the API key is correct and active

**"No expirations found"**
- Check if the symbol is valid and has options
- Try increasing `--max-days` parameter
- Verify your API key has options data access

**"No iron condors found"**
- Try relaxing your filters (lower `--min-credit`, higher `--max-risk`)
- Check if the symbol has sufficient options liquidity
- Try different symbols (SPY, QQQ, AAPL typically have good liquidity)

**API Rate Limits**
- Free accounts have limited requests per minute
- Add delays between requests if needed
- Consider upgrading to a paid plan for higher limits

### Debug Mode

Enable debug logging to see detailed information:

```bash
# Set DEBUG=true in your .env file
DEBUG=true

# Then run your command
python screener.py find --symbol SPY
```

## 🤝 Contributing

Contributions are welcome! Please feel free to submit issues, feature requests, or pull requests.

### Development Setup

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## 📄 License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.