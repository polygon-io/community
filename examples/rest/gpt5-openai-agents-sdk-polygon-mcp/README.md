# GPT-5 + OpenAI Agents SDK + Polygon.io MCP Server — Agentic Financial Analyst Demo

<div align="center">
  <img src="../../../images/logo.png" alt="Project Logo" width="100%"/>
</div>

A simple Python CLI for natural language financial queries using [GPT‑5](https://openai.com/gpt-5/) via the [OpenAI](https://openai.com/) [Agents SDK](https://openai.github.io/openai-agents-python/) and the [Polygon.io](https://polygon.io/) [MCP server](https://github.com/polygon-io/mcp_polygon). It also supports saving analyses as Markdown reports.

## Features

- **Ask questions like:**  
  - `last trade for AAPL`  
  - `aggregates for MSFT from 2024-01-01 to 2024-03-01 daily`  
  - `ticker details TSLA`
  - `analyze the return on investment between microsoft and meta. review news, ratings, earning. save a report`

- **Rich CLI output:**  
  Answers are formatted for easy reading in your terminal.

- **Save Markdown reports:**  
  Ask the agent to save its analysis and it will write a Markdown report under `reports/<category>/...`.

## Disclaimer

**Warning:** The examples, demos, and outputs produced with this project are generated by artificial intelligence and large language models. You acknowledge that this project and any outputs are provided "AS IS", may not always be accurate and may contain material inaccuracies even if they appear accurate because of their level of detail or specificity, outputs may not be error free, accurate, current, complete, or operate as you intended, you should not rely on any outputs or actions without independently confirming their accuracy, and any outputs should not be treated as financial or legal advice. You remain responsible for verifying the accuracy, suitability, and legality of any output before relying on it.

---

## Quickstart (with [uv](https://github.com/astral-sh/uv))

1. **Install [uv](https://github.com/astral-sh/uv) if you don’t have it:**
    ```sh
    curl -Ls https://astral.sh/uv/install.sh | sh
    ```

2. **Get your API keys:**
   - [OpenAI API key](https://platform.openai.com/api-keys)
   - [Polygon.io API key](https://polygon.io/)

3. **Create a `.env` file in the same directory as `main.py`:**
    ```
    OPENAI_API_KEY=sk-...
    POLYGON_API_KEY=your_polygon_api_key_here
    ```
    Both keys are required for the CLI to work.

4. **Run the CLI (dependencies will be auto-installed from `pyproject.toml`):**
    ```sh
    uv run main.py
    ```

5. **Type your question and press Enter!**  
   Type `exit` to quit.

---

## Example Usage

```
> last trade for AAPL
✔ Query processed successfully!
Agent Response:
$AAPL last trade: $XXX.XX at 2025-08-13 15:30:00 UTC
---------------------

> exit
Goodbye!
```

For reference, the analysis agent follows instruction steps like:

```
1. Verify finance-related using guardrail
2. Gather market data with Polygon.io tools
3. Include disclaimers
4. Offer to save reports when appropriate
```

Be specific in your prompt. The better the prompt — the better the response.

---

## Troubleshooting

- **Missing API Key:**  
  If you see an error about `POLYGON_API_KEY` or `OPENAI_API_KEY`, make sure your `.env` file is in the same directory and contains both keys:
  ```
  OPENAI_API_KEY=sk-...
  POLYGON_API_KEY=your_polygon_api_key_here
  ```

- **`uvx: command not found`:**  
  Install `uv` with `pipx install uv` or `pip install uv`.

- **Dependencies:**  
  `uv run` will install from `pyproject.toml`. If you prefer pip:
  ```sh
  pip install openai-agents pydantic rich python-dotenv openai
  python main.py
  ```

- **Guardrail blocks non‑finance prompts:**  
  Try a market or finance-related query.

- **Other errors:**  
  All errors are printed in red in the terminal for easy debugging.

---

## How it Works

- Loads your OpenAI and Polygon API keys from `.env`.
- Starts the Polygon MCP server over stdio: `uvx --from git+https://github.com/polygon-io/mcp_polygon@v0.4.0 mcp_polygon` (no manual server setup).
- Runs a GPT‑5 analysis agent (OpenAI Agents SDK) with a finance guardrail and tools.
- Can save formatted analyses via `save_analysis_report` to `reports/<category>/...`.
- Persists short‑term session context while the CLI runs and renders rich output.

---

## License

This project is licensed under the [MIT License](../../../LICENSE).
